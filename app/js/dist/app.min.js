
var app = angular.module('app', [ 'ngRoute', 'ngTouch', 'ngResource', 'ngCookies', 'ngAnimate', 'ui.bootstrap'])
  .config(function($routeProvider, $locationProvider) {
    $locationProvider.html5Mode(true);
  })
  .run(function($rootScope) {

  });

});

(function() {
    'use strict';

    angular
        .module('app')
        .controller('DinnerCtrl', DinnerCtrl);

        function DinnerCtrl($scope, Dinner) {
            $scope.dinner = Dinner;
            $scope.numberOfGuests = Dinner.getNumberOfGuests();

            $scope.setNumberOfGuest = function(number){
                Dinner.setNumberOfGuests(number);
            }

            $scope.getNumberOfGuests = function() {
                return Dinner.getNumberOfGuests();
            }

            $scope.$watch('dinner.getMenu()', function(newval,oldval,scope) {
              console.log({newval, oldval});
              $scope.menu = newval;
            });
        }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .controller('DishesCtrl', DishesCtrl);

        function DishesCtrl($scope, $routeParams, Dinner) {
            const id = $routeParams.dishId;
            Dinner.Dish.get({id}).$promise
                .then(function(data) {
                  console.log(data);
                    $scope.data = data;
                })
                .catch(function(err) {
                    $scope.status = "There was an error";
                });
            $scope.back = function() {
              window.history.back();
            }

            $scope.addDish = function(data) {
              Dinner.addToMenu(data);
              window.history.back();
            }
        }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .controller('HomeCtrl', HomeCtrl);

        function HomeCtrl($scope) {}
})();

(function() {
    'use strict';

    angular
        .module('app')
        .controller('SearchCtrl', SearchCtrl);

        function SearchCtrl($scope, Dinner) {
          $scope.options = [
            {
              name: 'Appetizer',
              value: 'appetizer'
            },
            {
              name: 'Main Course',
              value: 'main course'
            },
            {
              name: 'Dessert',
              value: 'dessert'
            }
          ];

          $scope.selectedOption = $scope.options[0];

          $scope.search = function(query,type) {
            console.log(query);
            console.log(type);
              $scope.status = "Searching...";
              Dinner.DishSearch.get({query:query, type:type}).$promise
                  .then(function(resp) {
                      const data = resp.toJSON();
                      const results = data.results;
                      const length = results.length;

                      $scope.dishes = results;
                      $scope.status = "Showing " + length + " results";
                  })
                  .catch(function(err) {
                      $scope.status = "There was an error";
                  });
            }
        }
})();

(function() {
    'use strict';

    angular
        .module('app')
        .factory('Dinner', Dinner);

        function Dinner($resource, $cookies) {
            let numberOfGuests = 2;
            let YOLO = 1;
            const menu = []; // type -> dish

            // Monkey patch
            function getType(dishTypes) {
                if(dishTypes.includes('appetizer')) {
                    return 'appetizer';
                } else if (dishTypes.includes('dessert')) {
                    return 'dessert';
                } else {
                    return 'main course';
                }
            }

            this.setNumberOfGuests = function(num) {
                numberOfGuests = num;
            }

            this.getNumberOfGuests = function() {
                return numberOfGuests;
            }

            this.DishSearch = $resource('https://spoonacular-recipe-food-nutrition-v1.p.mashape.com/recipes/search',{},{
                get: {
                    headers: {
                        'X-Mashape-Key': 'Qu9grxVNWpmshA4Kl9pTwyiJxVGUp1lKzrZjsnghQMkFkfA4LB'
                    },
                },
            });

            this.Dish = $resource('https://spoonacular-recipe-food-nutrition-v1.p.mashape.com/recipes/:id/information',{},{
                get: {
                    headers: {
                        'X-Mashape-Key': 'Qu9grxVNWpmshA4Kl9pTwyiJxVGUp1lKzrZjsnghQMkFkfA4LB'
                    },
                    transformResponse: function(resp, headersGetter, status) {
                      let total = 0;
                      const data = JSON.parse(resp);
                      const ingredients = data.extendedIngredients.map(function (ingredient) {
                        const cost = ingredient.amount * YOLO;
                        total = total + cost;
                        return Object.assign(ingredient, {cost})
                      })
                      return Object.assign(data, {
                        type: getType(data.dishTypes),
                        extendedIngredients: {
                          total,
                          ingredients,
                        },
                      });
                    },
                },
            });

            this.addToMenu = function(dish) {
                menu[dish.type] = dish;
            }

            this.deleteFromMenu = function(dish) {
                delete menu[dish.type];
            }

            this.getMenu = function() {
                return menu;
            }

            return this;
        }
})();

//# sourceMappingURL=app.min.js.map
